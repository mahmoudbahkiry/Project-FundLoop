{"version":3,"names":["useEffect","useMemo","useState","drawAsImageFromPicture","drawAsPicture","Skia","useImage","Rea","createTexture","texture","picture","size","value","useTexture","element","width","height","setPicture","x","y","then","pic","usePictureAsTexture","useTextureAsValue","console","warn","useTextureValueFromPicture","useSharedValue","runOnUI","useImageAsTexture","source","image","recorder","PictureRecorder","canvas","beginRecording","drawImage","finishRecordingAsPicture"],"sources":["textures.tsx"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\nimport type { ReactElement } from \"react\";\nimport type { SharedValue } from \"react-native-reanimated\";\n\nimport type {\n  DataSourceParam,\n  SkImage,\n  SkPicture,\n  SkSize,\n} from \"../../skia/types\";\nimport {\n  drawAsImageFromPicture,\n  drawAsPicture,\n} from \"../../renderer/Offscreen\";\nimport { Skia, useImage } from \"../../skia\";\n\nimport Rea from \"./ReanimatedProxy\";\n\nconst createTexture = (\n  texture: SharedValue<SkImage | null>,\n  picture: SkPicture,\n  size: SkSize\n) => {\n  \"worklet\";\n  texture.value = drawAsImageFromPicture(picture, size);\n};\n\nexport const useTexture = (element: ReactElement, size: SkSize) => {\n  const { width, height } = size;\n  const [picture, setPicture] = useState<SkPicture | null>(null);\n  useEffect(() => {\n    drawAsPicture(element, {\n      x: 0,\n      y: 0,\n      width,\n      height,\n    }).then((pic) => setPicture(pic));\n  }, [element, width, height]);\n  return usePictureAsTexture(picture, size);\n};\n\nexport const useTextureAsValue = (element: ReactElement, size: SkSize) => {\n  console.warn(\"useTextureAsValue has been renamed to use useTexture\");\n  return useTexture(element, size);\n};\n\nexport const useTextureValueFromPicture = (\n  picture: SkPicture | null,\n  size: SkSize\n) => {\n  console.warn(\n    \"useTextureValueFromPicture has been renamed to use usePictureAsTexture\"\n  );\n  return usePictureAsTexture(picture, size);\n};\n\nexport const usePictureAsTexture = (\n  picture: SkPicture | null,\n  size: SkSize\n) => {\n  const texture = Rea.useSharedValue<SkImage | null>(null);\n  useEffect(() => {\n    if (picture !== null) {\n      Rea.runOnUI(createTexture)(texture, picture, size);\n    }\n  }, [texture, picture, size]);\n  return texture;\n};\n\nexport const useImageAsTexture = (source: DataSourceParam) => {\n  const image = useImage(source);\n  const size = useMemo(() => {\n    if (image) {\n      return { width: image.width(), height: image.height() };\n    }\n    return { width: 0, height: 0 };\n  }, [image]);\n  const picture = useMemo(() => {\n    if (image) {\n      const recorder = Skia.PictureRecorder();\n      const canvas = recorder.beginRecording({\n        x: 0,\n        y: 0,\n        width: size.width,\n        height: size.height,\n      });\n      canvas.drawImage(image, 0, 0);\n      return recorder.finishRecordingAsPicture();\n    } else {\n      return null;\n    }\n  }, [size, image]);\n  return usePictureAsTexture(picture, size);\n};\n"],"mappings":"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","ignoreList":[]}